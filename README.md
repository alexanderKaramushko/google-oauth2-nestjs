# SSO-сервис на Google OAuth 2.0

## Алгоритм авторизации

Предусловия: пользователь не авторизован

1. Редирект пользователя с серверного эндпоинта на экран авторизации Google
2. Пользователь вводит данные, авторизуется, происходит редирект на сервер
3. Сервер ищет пользователя в БД
4. Если пользователь существует, то возвращается JWT
5. Если пользователь не существует, то создается пользователь в БД и возвращается JWT

## Как работает

1. Регистрируется приложение в console.cloud
2. Создается стратегия passport-google-oauth2, согласно протоколу OAuth 2.0
   реализуется метод verify, который проверяет/создает пользователя и возвращает JWT
3. Пробрасывается Client ID и Client secret приложения в стратегии passport-google-oauth2
4. Создается роут /auth/login для редиректа на Google-авторизацию
5. Создается роут /oauth2/redirect/google, на которой происходит редирект после авторизации в Google
6. На роуты из пунктов 3 и 5 навешиваются гарды, которые делают редиректы и verify-проверку

## Архитектура

– Database module, модуль подключения к базе данных и создания DAO
– User module, CRUD-сервис управления пользователями
– Auth module, модуль аутентификации/авторизации пользователей

Поднимается Docker-контейнеры c БД, сервером и Secret Vault.

## Стек технологий:

– @nestjs/jwt
– @nestjs/passport, проверка кредов, выпуск токенов, обогащение запросов
– passport-google-oauth2
– passport-local

## Ресурсы

[Google OAuth 2.0](https://developers.google.com/identity/protocols/oauth2?hl=ru)
